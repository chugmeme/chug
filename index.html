<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CHUG - Infinite Prosperity</title>
  <meta name="description" content="CHUG - The ultimate stage of cosmic prosperity.">
  <link rel="icon" href="favicon.ico">

  <!-- Fonts: Fredoka One for CHUG title, Plus Jakarta Sans for other text -->
  <link 
    href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" 
    rel="stylesheet"
  >

  <!-- Our External CSS -->
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <!-- Infinite background gradient -->
  <div class="infinite-bg"></div>

  <!-- Floating Orb Navigation -->
  <div class="floating-orb">
    <div class="orb" aria-label="Open navigation menu" role="button" tabindex="0"></div>
    <div class="nav-hints">
      <a href="#about">About</a>
      <a href="#tokenomics">Tokenomics</a>
      <a href="#mission">Mission</a>
      <a href="#community">Community</a>
    </div>
  </div>
  
  <!-- HERO SECTION -->
  <section class="hero">
    <div class="cosmic-canvas">
      <canvas id="cosmosCanvas"></canvas>
    </div>
    <div class="hero-content fade-in">
      <!-- Special large hero heading -->
      <h1 class="hero-heading glow">
        <span class="intro-line">This is</span>
        CHUG
      </h1>

      <div class="mascot-wrap">
        <!-- Hero Mascot (alpha video) -->
        <video 
          id="mascotVideo" 
          class="mascot" 
          autoplay 
          loop 
          muted 
          playsinline 
          webkit-playsinline 
          preload="auto" 
          poster="fallback.png">
        </video>
      </div>

      <!-- Briefer text in the same cosmic style -->
      <p>
        At the <em>end of all horizons</em>, where <em>infinite abundance</em> 
        meets <strong>eternal happiness</strong>, <strong>CHUG</strong> arrives 
        to bestow <em>everything</em> upon you.
      </p>
      
      <a href="#tokenomics" class="cta-button">CHUG the Universe</a>
    </div>
  </section>

  <!-- ABOUT SECTION -->
  <section id="about" class="fade-section">
    <div class="content-container">
      <h2>Pure Integration</h2>
      <p>
        In this final form, all cultural streams—art, innovation, humor, wisdom, technology—meld seamlessly. 
        <em>CHUG</em> distills countless eras and civilizations into a serene reservoir of infinite giving, 
        where every drop is <strong>yours</strong>.
      </p>
    </div>
  </section>

  <!-- TOKENOMICS SECTION -->
  <section id="tokenomics" class="fade-section">
    <div class="content-container">
      <h2>Tokenomics</h2>
      <p>
        Like gentle waves in an ocean of prosperity, these allocations ensure that <em>liquidity</em> 
        and <strong>abundance</strong> forever replenish. Each percentage is a quiet promise that 
        everyone drinks freely from this wellspring.
      </p>
      <div class="tokenomics-grid">
        <button class="tokenomics-item" aria-label="Infinite Circulation">
          <h3>70%</h3>
          <p><em>Infinite Circulation</em></p>
        </button>
        <button class="tokenomics-item" aria-label="Communal Flourish">
          <h3>15%</h3>
          <p><strong>Communal Flourish</strong></p>
        </button>
        <button class="tokenomics-item" aria-label="Celestial Gifts">
          <h3>10%</h3>
          <p><em>Celestial Gifts</em></p>
        </button>
        <button class="tokenomics-item" aria-label="Eternal Growth">
          <h3>5%</h3>
          <p><strong>Eternal Growth</strong></p>
        </button>
      </div>
    </div>
  </section>

  <!-- OUR MISSION SECTION -->
  <section id="mission" class="fade-section">
    <div class="content-container">
      <h2>Our Mission</h2>
      <p>
        To unite all forms of value—material, cultural, intellectual—into a single, radiant stream. 
        With <strong>CHUG</strong> guiding the flow, every participant becomes a beneficiary 
        of cosmic harmony and <em>wealth</em>.
      </p>
    </div>
  </section>

  <!-- COMMUNITY SECTION -->
  <section id="community" class="fade-section">
    <div class="content-container">
      <h2>Join the Eternal Flow</h2>
      <p>
        Step forward and <em>CHUG</em> deeply from the spring of limitless prosperity. Let the currents 
        of abundance, culture, and joy fill your life. This is your birthright; embrace it.
      </p>
      <a href="#" class="cta-button community-cta">Drink Infinity Now</a>
    </div>
  </section>

  <!-- COIN RANKS SECTION (iOS-inspired, central alignment) -->
  <section id="coin-rank" class="fade-section">
    <div class="content-container">
      <h2>Obstacles in Orbit: CHUG’s Cosmic Unfolding</h2>
      <p>
        Temporary obstacles before the grand expanse that is CHUG. Tilt your gaze if you wish; 
        soon enough, our cosmic wave rolls on, untouched and unbound.
      </p>
      <div class="coin-rank-grid" id="coin-rank-container">
        <!-- Cards will be injected here by JS -->
      </div>
    </div>
  </section>

  <!-- Chaos Mascot (alpha video) that roams the page -->
  <video 
    id="chaosMascot"
    class="chaos-mascot"
    autoplay 
    loop 
    muted 
    playsinline 
    webkit-playsinline 
    poster="fallback.png">
  </video>

  <footer>
    <div class="footer-content">
      <p>
        &copy; 2024 <strong>CHUG</strong>. Flowing beyond boundaries, granting all that is 
        and ever will be—forever <em>yours</em>.
      </p>
    </div>
  </footer>

  <!-- ======================================
       JS IN THE HTML FOR DEMO
       ======================================= -->
  <script>
    /* ================
       COSMOS BACKGROUND
       ================ */
    const canvas = document.getElementById('cosmosCanvas');
    const ctx = canvas.getContext('2d');
    let w = canvas.width = window.innerWidth;
    let h = canvas.height = window.innerHeight;

    const paletteColors = [
      'rgba(151,253,228,0.7)',
      'rgba(52,153,140,0.7)',
      'rgba(237,255,252,0.7)'
    ];

    const particles = [];
    for (let i = 0; i < 120; i++) {
      particles.push({
        x: Math.random() * w,
        y: Math.random() * h,
        vx: (Math.random() - 0.5) * 0.5,
        vy: (Math.random() - 0.5) * 0.5,
        r: Math.random() * 3 + 1,
        color: paletteColors[Math.floor(Math.random() * paletteColors.length)]
      });
    }

    function animateStars() {
      ctx.clearRect(0, 0, w, h);
      ctx.globalCompositeOperation = 'lighter';
      for (let p of particles) {
        p.x += p.vx;
        p.y += p.vy;
        if (p.x < 0 || p.x > w) p.vx *= -1;
        if (p.y < 0 || p.y > h) p.vy *= -1;
        
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
        ctx.fillStyle = p.color;
        ctx.fill();
      }
      requestAnimationFrame(animateStars);
    }
    animateStars();

    window.addEventListener('resize', () => {
      w = canvas.width = window.innerWidth;
      h = canvas.height = window.innerHeight;
    });

    /* ================
       ORB NAVIGATION
       ================ */
    const orb = document.querySelector('.floating-orb .orb');
    const navHints = document.querySelector('.nav-hints');
    let navOpen = false;

    function toggleNav() {
      navOpen = !navOpen;
      if (navOpen) {
        navHints.classList.add('show');
        document.addEventListener('click', handleOutsideClick);
      } else {
        navHints.classList.remove('show');
        document.removeEventListener('click', handleOutsideClick);
      }
    }

    orb.addEventListener('click', (e) => {
      e.stopPropagation();
      toggleNav();
    });

    function handleOutsideClick(e) {
      if (!e.target.closest('.floating-orb') && navOpen) {
        toggleNav();
      }
    }

    navHints.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        if (navOpen) toggleNav();
      });
    });

    /* ==========================================
       CAPABILITY-BASED VIDEO FORMAT DETECTION 
       (For the main hero mascot)
       ========================================== */
    const player = document.getElementById('mascotVideo');
    const testVideo = document.createElement('video');

    // Test HEVC alpha support (Safari iOS 15.4+)
    const hevcAlphaSupport = testVideo.canPlayType('video/mp4; codecs="hvc1.2.4.L153.B0"') ||
                             testVideo.canPlayType('video/mp4; codecs="hvc1.1.6.L93.B0"') ||
                             testVideo.canPlayType('video/mp4; codecs="hvc1"') ||
                             testVideo.canPlayType('video/quicktime; codecs="hvc1"');

    // Test VP9 in WebM support
    const vp9Support = testVideo.canPlayType('video/webm; codecs="vp9"');

    if (hevcAlphaSupport === 'probably' || hevcAlphaSupport === 'maybe') {
      player.src = 'okchug.mov';  // your alpha .mov
    } else if (vp9Support === 'probably' || vp9Support === 'maybe') {
      player.src = 'okchug9.webm'; // your alpha .webm
    } else {
      console.warn('Neither HEVC alpha nor VP9 alpha is supported by this browser for hero mascot.');
    }

    /* =====================================
       TOKENOMICS CARD CLICK HANDLING
       ===================================== */
    document.querySelectorAll('.tokenomics-item').forEach(item => {
      item.addEventListener('click', () => {
        const detailId = item.getAttribute('aria-label')
                            .toLowerCase()
                            .replace(' ', '-');
        const detailSection = document.getElementById(detailId);
        if (detailSection) {
          detailSection.scrollIntoView({ behavior: 'smooth' });
        }
      });
    });

    /* =================================================
       DISTORTION TRIGGER ON HERO MASCOT CLICK/TOUCH
       ================================================= */
    const mascotWrap = document.querySelector('.mascot-wrap');

    player.addEventListener('click', () => {
      mascotWrap.classList.add('distort');
      // Distort for 5 seconds
      setTimeout(() => {
        mascotWrap.classList.remove('distort');
      }, 5000);
    });

    /* ===============================
       CHAOS MASCOT THAT ROAMS THE PAGE
       =============================== */
    const chaosMascot = document.getElementById('chaosMascot');

    if (hevcAlphaSupport === 'probably' || hevcAlphaSupport === 'maybe') {
      chaosMascot.src = 'chugfloat.mov';
    } else if (vp9Support === 'probably' || vp9Support === 'maybe') {
      chaosMascot.src = 'chugfloat.webm';
    } else {
      console.warn('No alpha video support for chaos mascot, using fallback.');
    }

    let cx = Math.random() * (window.innerWidth - 80);
    let cy = Math.random() * (window.innerHeight - 80);
    let cvx = (Math.random() - 0.5) * 5; 
    let cvy = (Math.random() - 0.5) * 5;
    const chaosSize = 80;

    let baseSpeedFactor = 1;
    let currentSpeedFactor = 1;
    let clickTime = 0;
    let accelActive = false;
    const accelDuration = 5000; // 5s of acceleration

    function getHeroBubbleData() {
      const rect = mascotWrap.getBoundingClientRect();
      const hx = rect.left + rect.width / 2;
      const hy = rect.top + rect.height / 2;
      const hr = Math.min(rect.width, rect.height) / 2;
      return { hx, hy, hr };
    }

    function moveChaos(timestamp) {
      if (accelActive) {
        const elapsed = timestamp - clickTime;
        if (elapsed < accelDuration) {
          const t = elapsed / accelDuration;
          // Gradually slow from speed factor 3 back to 1
          currentSpeedFactor = 3 - 2 * t;
        } else {
          currentSpeedFactor = baseSpeedFactor;
          accelActive = false;
        }
      }

      cx += cvx * currentSpeedFactor;
      cy += cvy * currentSpeedFactor;

      // Bounce off edges
      if (cx < 0) {
        cx = 0; 
        cvx = -cvx;
      }
      if (cx + chaosSize > window.innerWidth) {
        cx = window.innerWidth - chaosSize;
        cvx = -cvx;
      }
      if (cy < 0) {
        cy = 0;
        cvy = -cvy;
      }
      if (cy + chaosSize > window.innerHeight) {
        cy = window.innerHeight - chaosSize;
        cvy = -cvy;
      }

      // Collision with hero bubble
      const { hx, hy, hr } = getHeroBubbleData();
      const ccx = cx + chaosSize / 2;
      const ccy = cy + chaosSize / 2;
      const dx = ccx - hx;
      const dy = ccy - hy;
      const dist = Math.sqrt(dx * dx + dy * dy);
      const chaosRadius = chaosSize / 2;
      const sumR = chaosRadius + hr;

      if (dist < sumR) {
        // Overlap => bounce away
        const overlap = sumR - dist;
        const nx = dx / dist;
        const ny = dy / dist;
        cx += nx * overlap;
        cy += ny * overlap;
        const dot = cvx * nx + cvy * ny;
        cvx = cvx - 2 * dot * nx;
        cvy = cvy - 2 * dot * ny;

        // Trigger quick visual distortion
        chaosMascot.classList.add('bubble-distort');
        mascotWrap.classList.add('bubble-distort');
        setTimeout(() => {
          chaosMascot.classList.remove('bubble-distort');
          mascotWrap.classList.remove('bubble-distort');
        }, 500);
      }

      chaosMascot.style.left = cx + 'px';
      chaosMascot.style.top = cy + 'px';

      requestAnimationFrame(moveChaos);
    }
    requestAnimationFrame(moveChaos);

    // On click => triple speed for 5 seconds
    chaosMascot.addEventListener('click', () => {
      currentSpeedFactor = 3;
      accelActive = true;
      clickTime = performance.now();
    });

    // Recompute bounds on window resize
    window.addEventListener('resize', () => {
      if (cx + chaosSize > window.innerWidth) {
        cx = window.innerWidth - chaosSize;
      }
      if (cy + chaosSize > window.innerHeight) {
        cy = window.innerHeight - chaosSize;
      }
    });

    /* ===============================
       FADE SECTIONS ON SCROLL
       =============================== */
    const sections = document.querySelectorAll('.fade-section');

    const sectionObserver = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('in-view');
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1 });

    sections.forEach(section => {
      sectionObserver.observe(section);
    });

    /* ===============================
       COIN RANK FETCH AND RENDER
       (iOS-inspired, center-aligned)
       =============================== */
    const coinRankContainer = document.getElementById('coin-rank-container');
    fetch(
      `https://gist.githubusercontent.com/chugmeme/639de032a2725fd6b4713c529a5e9d11/raw/marketcaps.json?ts=${Date.now()}`,
      { cache: 'no-cache' }
    )
      .then(response => response.json())
      .then(data => {
        // Only want top 12 => first 11 plus last
        let coins = [...data];
        if (coins.length > 12) {
          coins = coins.slice(0, 11).concat(coins[coins.length - 1]);
        }

        // Render center-aligned, iOS-inspired cards
        coins.forEach(coin => {
          const marketcapFormatted = Intl.NumberFormat('en-US', {
            style: 'currency',
            currency: 'USD',
            maximumFractionDigits: 0
          }).format(coin.marketcap);

          const card = document.createElement('div');
          card.className = 'coin-rank-card';

          card.innerHTML = `
            <div class="card-inner">
              <!-- Round rank at the top -->
              <div class="circle-rank">#${coin.rank}</div>

              <!-- Larger symbol text -->
              <div class="symbol-text">${coin.symbol}</div>

              <!-- M.Cap label + value, stacked -->
              <div class="cap-wrap">
                <div class="mcap-label">M.Cap</div>
                <div class="mcap-value">${marketcapFormatted}</div>
              </div>
            </div>
          `;
          coinRankContainer.appendChild(card);
        });
      })
      .catch(err => {
        console.error('Failed to load coin data:', err);
        coinRankContainer.innerHTML = `<p>Failed to load coin data.</p>`;
      });
  </script>
</body>
</html>
